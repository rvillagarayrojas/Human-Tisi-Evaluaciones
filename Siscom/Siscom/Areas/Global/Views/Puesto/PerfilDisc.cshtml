@using Siscom.Models

@model Siscom.Areas.Global.Models.PuestoModels

@{
    ViewBag.Title = "Bandeja";
    Layout = "~/Views/Home/Principal.cshtml";
}

<div class="pageheader">
    <!--Region Cabecera de la Pagina-->
    <h1 style="font-family:Arial">REGISTRO DE PUESTO</h1>
    <div>
        <span class="label" style="color:rgb(144, 157, 163);padding:0px">USTED ESTÁ AQUÍ: </span>
        <ol class="breadcrumb">
            <li>
                <a href="#">Puesto</a>
            </li>
            <li>
                <a href="../../Global/Puesto/PerfilDisc" class="active">Perfil DISC</a>
            </li>
        </ol>
    </div>
</div>

<section id="main-content" class="animated fadeInUp">
<!--Region Botones-->
	<div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title" style="font-family:Arial"><b>REGISTRO DE PUESTO</b></h3>
                </div>
                <div class="panel-body">
                    <div id="widget-body">
                        <div class="row">
						    <form id="wizard-1" novalidate="novalidate">
							    <div id="bootstrap-wizard-1" class="col-sm-12">
								    <div class="form-bootstrapWizard">
                                        <ul class="bootstrapWizard form-wizard">
                                            <li class="active" data-target="#step1" style="width:33.33%">
                                                <a href="#tab1" data-toggle="tab">
                                                    <span class="step">1</span>
                                                    <span class="title">Definir puesto</span>
                                                </a>
                                            </li>
                                            <li data-target="#step2" style="width:33.33%">
                                                <a href="#tab2" data-toggle="tab">
                                                    <span class="step">2</span>
                                                    <span class="title">Asignar pruebas</span>
                                                </a>
                                            </li>
                                            <li data-target="#step3" style="width:33.33%">
                                                <a href="#tab3" data-toggle="tab">
                                                    <span class="step">3</span>
                                                    <span class="title">Análisis de Brechas</span>
                                                </a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tab1" style="font-family:Arial">
                                            <br />
                                            <br />
                                            <h3 style="font-family:Arial">
                                                <strong>Paso 1 </strong> - Definir puesto
                                            </h3>
                                            <br />
                                            <div class="row">
												<div class="form-group" style="margin:2%">
                                                    <label class="col-md-4 control-label" style="text-align:right; vertical-align:central;height: 37px;padding:1%">Nombre del puesto</label>
													<div class="col-sm-6 input-group">
														<span class="input-group-addon"><i class="fa fa-suitcase fa-md fa-fw"></i></span>
                                                        @Html.TextBoxFor(m => Model.Puesto.vc_desc_puesto,
                                                        new
                                                        {
                                                            maxLength = "100",
                                                            propertyname = "Puesto.vc_desc_puesto",
                                                            @class = "form-control",
                                                            style="text-transform :uppercase",
                                                            placeholder="Nombre del puesto"
                                                        })
													</div>
												</div>
												<div class="form-group" style="margin:2%">
                                                    <label class="col-md-4 control-label" style="text-align:right; vertical-align:central;padding:1%">Descripción del puesto</label>
													<div class="input-group">
														<span class="input-group-addon"><i class="fa fa-folder-open fa-md fa-fw"></i></span>                                                        
                                                        @Html.TextAreaFor(m => Model.Puesto.vc_desc_puesto,
                                                        new
                                                        {
                                                            propertyname = "Puesto.vc_desc_puesto",
                                                            @class = "form-control",
                                                            placeholder="Descripción del puesto",
                                                            rows= 6,
                                                        })
													</div>
												</div>
												<div class="form-group" style="margin:2%">
                                                    <label class="col-md-4 control-label" style="text-align:right; vertical-align:central">Solicitar ficha</label>
												    <div class="col-md-3">
                                                        @Html.RadioButtonFor(m => Model.Puesto.ch_estado, true, new { @checked = "checked", dato = "P" })
                                                        <label class="control-label">Si </label>                                         
                                                    </div>
                                                    <div class="col-md-3">
                                                        @Html.RadioButtonFor(m => Model.Puesto.ch_estado, false, new { dato = "C" })
                                                        <label class="control-label">No </label>
                                                    </div>
                                                </div><br />
												<div class="form-group" style="margin:2%">
                                                    <label class="col-md-4 control-label" style="text-align:right; vertical-align:central">Visualización del puesto</label>
												    <div class="col-md-3">
                                                        @Html.RadioButtonFor(m => Model.Puesto.ch_ficha, true, new { @checked = "checked", dato = "0" })
                                                        <label class="control-label">Público </label>                                         
                                                    </div>
                                                    <div class="col-md-3">
                                                        @Html.RadioButtonFor(m => Model.Puesto.ch_ficha, false, new { dato = "1" })
                                                        <label class="control-label">Confidencial </label>
                                                    </div>
                                                </div>
											</div>
                                        </div>
                                        <div class="tab-pane" id="tab2">
                                            <br />
                                            <br />
                                            <h3 style="font-family:Arial">
                                                <strong>Paso 2 </strong> - Asignar pruebas
                                            </h3>
                                            <br />
							                <div class="row">
                                                <input id="paso2" type="hidden"/>	
                                                <div class="col-md-12">
									                <div class="form-group" style="font-family:Arial;font-size:12px">
                                                        <div class="alert alert-info fade in">								               
								                            <i class="fa-fw fa fa-info-circle"></i>
                                                            <strong>Información adicional</strong>
                                                            <ul class="margin-bottom-none padding-left-lg">                                                    
												                <li>
													                Aquí puedes seleccionar todas las pruebas que creas necesarias para poder realizar el proceso de evaluación.
												                </li>
											                </ul>								                
							                            </div>
                                                    </div>
                                                </div>				
							                </div> 
                                            <!--Lista de Pruebas-->
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div id="div_ListaSolicitudes"  style="padding-top:1px">
                                                        @Html.Partial("VP_GrillaPrueba", Model)
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Region Botones-->
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="panel panel-default">
                                                        <div class="panel-body text-center">
                                                            <button id="guardarBtn" type="button" class="btn btn-success" 
                                                                onclick="Guardar()">
                                                                <i class="fa  fa-save"></i> Guardar
                                                            </button> 
                                                            <button id="cancelarBtn" type="button" class="btn btn-default" 
                                                                onclick="Cancelar()">
                                                                <i class="fa fa-reply"></i> Cancelar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="tab3">
                                            <br />
                                            <br />
                                            <h3 style="font-family:Arial">
                                                <strong>Paso 2 </strong> - Determinar perfil DISC
                                            </h3>
                                            <br />
							                <div class="row">
                                            <input id="paso2" type="hidden"/>	
                                            <div class="col-sm-12">
									            <div class="form-group" style="font-family:Arial;font-size:12px">
                                                    <div class="alert alert-info fade in">								               
								                        <i class="fa-fw fa fa-info-circle"></i>
                                                        <strong>Información adicional</strong>
                                                        <ul class="margin-bottom-none padding-left-lg">                                                    
												            <li>
													            Debe consignar los correos de las personas que definiran el perfil DISC que se necesita para el puesto.
												            </li>
											            </ul>
								                
							                        </div>
                                                </div>
                                            </div>				
							                </div>
                                            <!--Lista de Candidatos-->
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="panel panel-default">
                                                        <div  style="padding:5px">
                                                            <h3 style="font-family:Arial; font-size:14px"><strong>- Enviar el test a:</strong></h3>
                                                        </div>
                                                        <div class="panel-body data-toggle="collapse">
                                                            <div id="div_ListaSolicitudes" class="table-responsive" style="padding-top:1px">
                                                             @Html.Partial("VP_GrillaCandidatos", Model)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Region Botones-->
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="panel panel-default">
                                                        <div class="panel-body text-center">
                                                            <button id="guardarBtn" type="button" class="btn btn-success" 
                                                                onclick="GuardarCandidatos()">
                                                                <i class="fa fa-save"></i> Guardar
                                                            </button>                    
                                                            <button id="guardarBtn" type="button" class="btn btn-info" 
                                                                onclick="GuardarEnviar()">
                                                                <i class="fa fa-jsfiddle"></i> Guardar y Enviar Correo 
                                                            </button>
                                                            <button id="cancelarBtn" type="button" class="btn btn-warning" 
                                                                onclick="CancelarCandidatos()">
                                                                <i class="fa fa-eraser"></i> Limpiar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>									
                                </div>
                            </form>    
                        </div>
                    </div>
                </div>
            </div>
        </div>                    
    </div>
</section>
<!--Modal para mensajes-->
<div class="modal fade" id="ModalSave" style="overflow: scroll;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title" id="myModalLabel" style="color:#0D588E">Mensaje de creación de puestos</h3>
            </div>
            <div class="modal-body" id="SaveMensaje">
            </div>
            <div class="text-center">
                <hr /><button id="btnMensaje" type="button" class="btn btn-primary" onclick="$('#ModalSave').modal('hide');">Aceptar</button>
            </div>
        </div>
    </div>
</div>

@section Styles {
@Styles.Render("~/plugins/dataTablesCSS")
}

<!--Load these page level functions-->
@section Scripts {
@Scripts.Render("~/plugins/dataTables")
@Scripts.Render("~/plugins/dataTables-bootstrap")
@Scripts.Render("~/plugins/maskedinput")


<script type="text/javascript" src="~/Scripts/plugins/datetimepicker/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="~/Scripts/plugins/datetimepicker/locales/bootstrap-datetimepicker.es.js" charset="UTF-8"></script>
<link href="~/Content/bootstrap-datetimepicker.min.css" rel="stylesheet" />

<script type="text/javascript" src="~/Scripts/plugins/blockUI/js/jquery.blockUI.js" charset="UTF-8"></script>
<script src="~/Scripts/jquery.number.js"></script>
<script src="~/Scripts/jquery.number.min.js"></script>

<script type="text/javascript">  
    $(document).ready(function () {
        Buscar();
    });

    function Guardar() {
        var statusVal = true;
        var resumen = "";

        if ($('#Puesto_vc_desc_puesto').val() == "") {
            resumen = resumen + '<li>Debe ingresar una descripción del puesto. </li>';
            statusVal = false;
        }
        if (!statusVal) {
            $("#SaveMensaje").html("<ol>" + resumen + "</ol>");
            $("#ModalSave").modal('show');
            return false;
        }

        var PruebaDetalle = [];

        $('#ContenedorPruebas input').each(function () {
            if ($(this).prop('checked')) {
                PruebaDetalle[PruebaDetalle.length] = {
                    nu_id_prueba: ($(this).attr('name').split("~")[0]),
                    nu_id_clasificacion: ($(this).attr('name').split("~")[1])
                }
            }
        })

        var Puesto = {
            vc_desc_puesto: $('#Puesto_vc_desc_puesto').val().toUpperCase(),
            ch_estado: $("input[name='Puesto.ch_estado']:checked").attr('dato'),
            ch_ficha: $("input[name='Puesto.ch_ficha']:checked").attr('dato'),
            PruebaDetalle: PruebaDetalle
        }
        var Model = new Object();
        Model.Puesto = Puesto;
        $("#guardarBtn").attr('disabled', 'disabled');
        $("#SaveMensaje").html('<i class="fa fa-refresh" style="color:green"></i> Registrando el puesto espere un momento...');
        $("#ModalSave").modal('show');
        $.ajax({
            type: "POST",
            url: GetControllerUrl("Guardar", "Puesto"),
            data: Model,
            success: function (resultado) {
                if (resultado.message == "go") {

                    $("#SaveMensaje").html('<i class="fa  fa-check" style="color:green"></i> Se registro el puesto <strong>' + $('#Puesto_vc_desc_puesto').val().toUpperCase() + '</strong> satisfactoriamente.');
                    /*Despues de registrar este evento permite redireccionar la pagina*/
                    $('#ModalSave').on('hidden.bs.modal', function () {
                        window.location.href = GetControllerUrl("Index", "Puesto");
                    });
                }
                else {
                    $("#guardarBtn").removeAttr('disabled');
                    $("#SaveMensaje").html('<i class="fa  fa-remove" style="color:darkred"></i> No se completo el registro del puesto: <br><strong>' + resultado.message + '</strong>');
                }
            }
        });
    }
    function Cancelar() {
        window.location.href = GetControllerUrl("Index", "Puesto");
    }
    function Buscar() {
        $("#SaveMensaje").html('<i class="fa  fa-refresh" style="color:green"></i> Buscando pruebas, espere un momento...');
        $("#ModalSave").modal('show');
        var data = {
            IdNivelPrueba: 1,
        };
        $.ajax({
            type: 'POST',
            url: '/Global/Puesto/BuscarPruebas',
            data: data,
            success: function (result) {
                $('#div_ListaSolicitudes').andSelf().unbind();
                $('#div_ListaSolicitudes').html(result);
                if (result.trim() == "") {
                    $("#SaveMensaje").html('<i class="fa fa-remove" style="color:darkred"></i> No se encontró datos.');
                    $("#ModalSave").modal('show');
                }
                $("#ModalSave").modal('hide');
            }
        });
    }

    $(document).on('click', '.actions > .fa-chevron-down', function () {
        $(this).parent().parent().next().slideToggle("fast"), $(this).toggleClass("fa-chevron-down fa-chevron-up")
    })

    $(document).on('click', '.actions > .fa-chevron-up', function () {
        $(this).parent().parent().next().slideToggle("fast"), $(this).toggleClass("fa-chevron-down fa-chevron-up")
    })

    $(document).on('dblclick', '.check', function () {
        $(this).prop('checked', '')
    })
</script>
}
