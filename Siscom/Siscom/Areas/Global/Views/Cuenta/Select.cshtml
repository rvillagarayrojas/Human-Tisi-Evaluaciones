@using Siscom.Models

@model Siscom.Areas.Global.Models.CuentaModels 
@{
    ViewBag.Title = "Select";
    Layout = "~/Views/Home/Principal.cshtml";
}
<div class="pageheader">
    <!--Region Cabecera de la Pagina-->
    <h1>Ver Cuentas</h1>
    <div>
        <span class="label" style="color:rgb(144, 157, 163);padding:0px">USTED ESTÁ AQUÍ: </span>
        <ol class="breadcrumb">
            <li>
                <a href="#">Cuenta</a>
            </li>
            <li>
                <a href="#">Registro</a>
            </li>
            <li>
                <a href="#" class="active">Ver Cuentas</a>
            </li>
        </ol>
    </div>
</div>
<!--Region Cuerpo de la Pagina-->
<section id="main-content" class="animated fadeInUp">
<!--Region Botones-->
    <div class="row">
        <div class="col-xs-12">
           <div class="panel panel-default">                          
                <div class="panel-body text-left">
                     <button id="buscarBtn" type="button" class="btn btn-success btn-sm" onclick="Editar1();">
                        <i class="fa fa-pencil"></i> Editar
                     </button>
                </div>
            </div>
        </div>
    </div>

    <div id="DatosForm">
        <!--Region Panel (Filtros)-->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Datos de la Cuenta</h3>

                        <div class="actions pull-right">
                            <i class="fa fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-horizontal form-border" role="form">
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <div class="col-sm-7 row">
                                        @Html.HiddenFor(m => m.Cuenta.nu_id_cuenta,
                                        new
                                        {
                                            propertyname = "Cuenta.nu_id_cuenta",
                                            @class = "form-control",
                                        })
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        R.U.C
                                    </label>
                                    <div class="col-sm-7 row">
                                        @Html.TextBoxFor(m => m.Cuenta.vc_ruc,
                                        new
                                        {
                                            propertyname = "Cuenta.vc_ruc",
                                            @class = "form-control",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       Razón social
                                    </label>
                                    <div class="col-sm-7 row">
                                        @Html.TextBoxFor(m => m.Cuenta.vc_desc_cuenta,
                                        new
                                        {
                                            propertyname = "Cuenta.vc_desc_cuenta",
                                            @class = "form-control",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       Dirección
                                    </label>
                                    <div class="col-sm-7 row">
                                        @Html.TextBoxFor(m => m.Cuenta.vc_direccion,
                                        new
                                        {
                                            propertyname = "Cuenta.vc_direccion",
                                            @class = "form-control",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       Dirección E-mail
                                    </label>
                                    <div class="col-sm-7 row">
                                       @Html.TextBoxFor(m => m.Cuenta.vc_direccion_email,
                                        new
                                        {
                                            propertyname = "Cuenta.vc_direccion_email",
                                            @class = "form-control",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Nro telefónico
                                    </label>
                                    <div class="col-sm-7 row">
                                        @Html.TextBoxFor(m => Model.Cuenta.vc_telefono,
                                        new
                                        {
                                            maxLength = "100",
                                            propertyname = "Cuenta.vc_telefono",
                                            @class = "form-control",
                                            style="text-transform :uppercase",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       ChatBot KEY
                                    </label>
                                    <div class="col-sm-7 row">
                                       @Html.TextBoxFor(m => m.Cuenta.vc_chatbot_key,
                                        new
                                        {
                                            propertyname = "Cuenta.vc_chatbot_key",
                                            @class = "form-control",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!--Region Panel (Persona)-->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Datos de la persona contacto</h3>
                        <div class="actions pull-right">
                            <i class="fa fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-horizontal form-border" role="form">
                           <div class="form-group">
                                <div class="col-sm-6">
                                    <div class="col-sm-7 row">
                                        @Html.HiddenFor(m => m.Cuenta.nu_id_persona,
                                        new
                                        {
                                            propertyname = "Cuenta.nu_id_persona",
                                            @class = "form-control",
                                        })
                                    </div>
                                    <div class="col-sm-7 row">
                                        @Html.HiddenFor(m => m.Cuenta.nu_id_usuario,
                                        new
                                        {
                                            propertyname = "Cuenta.nu_id_usuario",
                                            @class = "form-control",
                                        })
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Nombres
                                    </label>
                                    <div class="col-sm-7 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.vc_nombres,
                                        new
                                        {
                                            maxLength = "50",
                                            propertyname = "Cuenta.vc_nombres",
                                            @class = "form-control",
                                            style="text-transform :uppercase",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Apellidos
                                    </label>
                                    <div class="col-sm-7 row">
                                        <p>
                                       @Html.TextBoxFor(m => Model.Cuenta.vc_apellidos,
                                        new
                                        {
                                            maxLength = "50",
                                            propertyname = "Cuenta.vc_apellidos",
                                            @class = "form-control",
                                            style="text-transform :uppercase",
                                            disabled = "disabled"
                                        })
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                 <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       D.N.I.
                                    </label>
                                    <div class="col-sm-7 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.vc_doc_identi,
                                        new
                                        {
                                            maxLength = "8",
                                            propertyname = "Cuenta.vc_doc_identi",
                                            @class = "form-control",
                                            onkeypress="return OnlyNumeric(event)",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Cargo
                                    </label>
                                    <div class="col-sm-7 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.vc_cargo,
                                        new
                                        {
                                            maxLength = "50",
                                            propertyname = "Cuenta.vc_cargo",
                                            @class = "form-control",
                                            style="text-transform :uppercase",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                            </div>
                             <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Dirección E-mail
                                    </label>
                                    <div class="col-sm-7 row">
                                        <p>
                                       @Html.TextBoxFor(m => Model.Cuenta.vc_direccion_email_usuario,
                                        new
                                        {
                                            maxLength = "50",
                                            propertyname = "Cuenta.vc_direccion_email_usuario",
                                            @class = "form-control",
                                            style="text-transform :lowercase",
                                            disabled = "disabled"
                                        })
                                        </p>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       Nro telefónico
                                    </label>
                                    <div class="col-sm-7 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.vc_telefono_usuario,
                                        new
                                        {
                                            maxLength = "9",
                                            propertyname = "Cuenta.vc_telefono_usuario",
                                            @class = "form-control",
                                            onkeypress="return OnlyNumeric(event)",
                                            disabled = "disabled"
                                        })
                                    </div>
                                </div>
                            </div>
                              <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                        Sexo
                                    </label>
                                      <div class="col-sm-4 row">
                                     @Html.RadioButtonFor(m => Model.Cuenta.ch_sexo, true, new { @checked = "checked", dato = "M" })
                                        <label class="control-label">Masculino </label> 
                                        
                                    </div>
                                    <div class="col-sm-4 row">
                                     @Html.RadioButtonFor(m => Model.Cuenta.ch_sexo, false, new { dato = "F" })
                                        <label class="control-label">Femenino</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<!--Region Panel (Contrato)-->
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Datos del contrato</h3>
                        <div class="actions pull-right">
                            <i class="fa fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-horizontal form-border" role="form">
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                      Tiempo de contrato
                                    </label>
                                    <div class="col-sm-4 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.nu_tiempo_duracion,
                                        new
                                        {
                                            maxLength = "5",
                                            propertyname = "Cuenta.nu_tiempo_duracion",
                                            @class = "form-control",
                                            @onchange = "FechaFinal()",
                                            disabled = "disabled"
                                        })
                                    
                                    </div>
                                    <label class="col-sm-2 control-label">
                                        meses
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-6">
                                     <label class="col-sm-4 control-label">
                                        Fecha de inicio
                                    </label>
                                    <div class="col-sm-6 input-group date" id="FecIniDt" data-date-format="dd MM yyyy" data-link-format="yyyy-mm-dd">
                                        <p>
                                            @Html.TextBoxFor(m => Model.Cuenta.dt_fecha_inicio, String.Format("{0:dd/MM/yyyy}", Model.Cuenta.dt_fecha_inicio),
                                            new
                                            {
                                                type = "text",
                                                propertyname = "Cuenta.dt_fecha_inicio",
                                                @class = "form-control",
                                                @onchange = "FechaFinal()",
                                                disabled = "disabled"

                                            })
                                        </p>
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </div>
                                </div>
                                </div> 
                                <div class="col-sm-6">
                                    <label class="col-sm-4 control-label">
                                       Fecha de fin
                                    </label>
                                    <div class="col-sm-7 row">
                                     @Html.TextBoxFor(m => Model.Cuenta.dt_fecha_fin, String.Format("{0:dd/MM/yyyy}", Model.Cuenta.dt_fecha_fin),
                                        new
                                        {   
                                            maxLength = "11",
                                            propertyname = "Cuenta.dt_fecha_fin",
                                            @class = "form-control",
                                            disabled = "disabled"
                                           
                                        })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<!--Region Botones-->
    <div id="botonVolver" class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="col-md-12" id="contenidoMensaje" style="color:rgb(203, 26, 26);padding:10px;margin-bottom:10px;visibility:hidden;background:rgb(245, 236, 236);">
                </div>
                <div class="panel-body text-center">                   
                    <button id="agregarBtn" type="button" class="btn btn-info"
                        onclick="Comeback(2)">
                        <i class="fa fa-reply"></i> Volver
                    </button>
                </div>
            </div>
        </div>
    </div>
<!--Region Botones-->
    <div id="botonesEditar" class="row" style="display:none">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body text-center">
                    <button id="guardarBtn" type="button" class="btn btn-success" 
                        onclick="Guardar()">
                        <i class="fa  fa-save"></i> Guardar
                    </button>                    
                   
                        <button id="cancelarBtn" type="button" class="btn btn-default" 
                            onclick="Cancelar()">
                            <i class="fa fa-reply"></i> Cancelar
                        </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!--Modal para mensajes-->
<div class="modal fade" id="ModalSave" style="overflow: scroll;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title" id="myModalLabel" style="color:#0D588E">Mensaje de actualización de cuentas</h3>
            </div>
            <div class="modal-body" id="SaveMensaje">
            </div>
            <div class="text-center">
                <hr /><button id="btnMensaje" type="button" class="btn btn-primary" onclick="$('#ModalSave').modal('hide');">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!--Load these page level functions-->
@section Scripts{ 
@Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/dataTables-bootstrap")
    @Scripts.Render("~/plugins/maskedinput")


    <script type="text/javascript" src="~/Scripts/plugins/datetimepicker/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="~/Scripts/plugins/datetimepicker/locales/bootstrap-datetimepicker.es.js" charset="UTF-8"></script>
    <link href="~/Content/bootstrap-datetimepicker.min.css" rel="stylesheet" />

    <script type="text/javascript" src="~/Scripts/plugins/blockUI/js/jquery.blockUI.js" charset="UTF-8"></script>
    <script src="~/Scripts/jquery.number.js"></script>
    <script src="~/Scripts/jquery.number.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            datetimepicker('#FecIniDt');
            datetimepicker('#FecFinDt');
        });

        function datetimepicker(identifier) {
            $(identifier).datetimepicker({
                language: 'es',
                weekStart: 1,
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                minView: 2,
                forceParse: 0,
                format: 'dd/mm/yyyy'
            });
        }

       /*1.- Cancelar acción*/
        function Comeback(dir) {
            switch (dir)
            {
                case 2: window.location.href = GetControllerUrl("Bandeja", "Cuenta"); break;
             }
        }
        function Cancelar() {
            window.location.href = GetControllerUrl("Bandeja", "Cuenta");
        }

        function FechaFinal() {
            var fecha = new Date($('#Cuenta_dt_fecha_inicio').val().replace(/(\d{2})\/(\d{2})\/(\d{4})/, "$3-$2-$1"));
                  
            fecha.setDate(fecha.getDate() + 1);

            console.log(fecha)

            dia = fecha.getDate();
            mes = fecha.getMonth() + 1;
            anio = fecha.getFullYear();
            tiempo = $('#Cuenta_nu_tiempo_duracion').val();
            addTime = tiempo * 1; //Tiempo en meses
            fecha.setMonth(fecha.getMonth() + addTime);
            dia1 = fecha.getDate() ;
            mes1 = (fecha.getMonth() + 1);
            anio1 = fecha.getFullYear();
            if (dia < 10) dia = '0' + dia;
            if (mes < 10) mes = '0' + mes;
            if (dia1 < 10) dia1 = '0' + dia1;
            if (mes1 < 10) mes1 = '0' + mes1;
            fecha_texto = dia + "/" + mes + "/" + anio;
            fecha_texto1 = dia1 + "/" + mes1 + "/" + anio1;


            if (fecha_texto == "NaN/NaN/NaN" || tiempo == "") {
                $('#Cuenta_dt_fecha_fin').val("");
                $('#Cuenta_dt_fecha_inicio').val("");
            }
            else {
                $('#Cuenta_dt_fecha_fin').val(fecha_texto1);
                $('#Cuenta_dt_fecha_inicio').val(fecha_texto);
            }
        }

        function Editar1(){
            $("#Cuenta_vc_ruc").removeAttr('disabled');
            $("#Cuenta_vc_desc_cuenta").removeAttr('disabled');
            $("#Cuenta_vc_direccion").removeAttr('disabled');
            $("#Cuenta_vc_direccion_email").removeAttr('disabled');
            $("#Cuenta_vc_telefono").removeAttr('disabled');
            $("#Cuenta_vc_nombres").removeAttr('disabled');
            $("#Cuenta_vc_apellidos").removeAttr('disabled');
            $("#Cuenta_vc_doc_identi").removeAttr('disabled');
            $("#Cuenta_vc_cargo").removeAttr('disabled');
            $("#Cuenta_vc_direccion_email_usuario").removeAttr('disabled');
            $("#Cuenta_vc_telefono_usuario").removeAttr('disabled');
            $("#Cuenta_nu_tiempo_duracion").removeAttr('disabled');
            $("#Cuenta_dt_fecha_inicio").removeAttr('disabled');
            $("#Cuenta_vc_chatbot_key").removeAttr('disabled');            
            document.getElementById('botonesEditar').style.display = 'block';
            document.getElementById('botonVolver').style.display = 'none';
        }

        function Guardar() {
            var Cuenta = {
                nu_id_cuenta:$('#Cuenta_nu_id_cuenta').val(),
                vc_desc_cuenta: $('#Cuenta_vc_desc_cuenta').val().toUpperCase(),
                vc_ruc: $('#Cuenta_vc_ruc').val(),
                vc_direccion: $('#Cuenta_vc_direccion').val().toUpperCase(),
                vc_direccion_email: $('#Cuenta_vc_direccion_email').val(),
                vc_telefono: $('#Cuenta_vc_telefono').val(),
                nu_tiempo_duracion: $('#Cuenta_nu_tiempo_duracion').val(),
                dt_fecha_inicio: $('#Cuenta_dt_fecha_inicio').val(),
                dt_fecha_fin: $('#Cuenta_dt_fecha_fin').val(),

                nu_id_persona: $('#Cuenta_nu_id_persona').val(),
                vc_nombres: $('#Cuenta_vc_nombres').val().toUpperCase(),
                vc_apellidos: $('#Cuenta_vc_apellidos').val().toUpperCase(),
                ch_sexo: $("input[name='Cuenta.ch_sexo']:checked").attr('dato'),
                vc_direccion_email_usuario: $('#Cuenta_vc_direccion_email_usuario').val(),
                vc_doc_identi: $('#Cuenta_vc_doc_identi').val(),
                vc_telefono_usuario: $('#Cuenta_vc_telefono_usuario').val(),
                vc_cargo: $('#Cuenta_vc_cargo').val().toUpperCase(),
                vc_chatbot_key: $('#Cuenta_vc_chatbot_key').val(),
            }
            var Model = new Object();
            Model.Cuenta = Cuenta;

            console.log(Model);

            $("#guardarBtn").attr('disabled', 'disabled');
            $("#SaveMensaje").html('<i class="fa fa-refresh" style="color:green"></i> Registrando la cuenta espere un momento...');
            $("#ModalSave").modal('show');
            $.ajax({
                type: "POST",
                url: GetControllerUrl("Actualizar", "Cuenta"),
                data: Model,
                success: function (resultado) {
                    if (resultado.message == "go") {

                        $("#SaveMensaje").html('<i class="fa  fa-check" style="color:green"></i> Se actualizo la cuenta <strong>' + $('#Cuenta_vc_ruc').val() + '</strong> satisfactoriamente.');
                        /*Despues de registrar este evento permite redireccionar la pagina*/
                        $('#ModalSave').on('hidden.bs.modal', function () {
                            window.location.href = GetControllerUrl("Bandeja", "Cuenta");
                        });
                    }
                    else {
                        $("#guardarBtn").removeAttr('disabled');
                        $("#SaveMensaje").html('<i class="fa  fa-remove" style="color:darkred"></i> No se completo el registro de la cuenta: <br> <strong>' + resultado.message + '</strong>');
                    }
                }
            });
        }
    </script>
}